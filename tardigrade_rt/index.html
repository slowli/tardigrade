<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Tardigrade runtime library."><title>tardigrade_rt - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-47e7ab555ef2818a.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="tardigrade_rt" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0-nightly (62ebe3a2b 2023-09-08)" data-channel="nightly" data-search-js="search-5d3eaacf19ebf04f.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-f194925aa375ae96.css" data-theme-dark-css="dark-1dd4d1ce031e15de.css" data-theme-ayu-css="ayu-49e58d069f567085.css" ><script src="../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-ef3a2de404864b0b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../static.files/light-f194925aa375ae96.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../static.files/dark-1dd4d1ce031e15de.css"><link rel="stylesheet" href="../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../tardigrade_rt/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../tardigrade_rt/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate tardigrade_rt</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">tardigrade_rt</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/tardigrade_rt/lib.rs.html#1-152">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Tardigrade runtime library.</p>
<p>The runtime provides a <a href="runtime/struct.Runtime.html" title="struct tardigrade_rt::runtime::Runtime"><code>Runtime</code></a> in which workflows defined in a WASM module
can be executed and <a href="struct.PersistedWorkflow.html" title="struct tardigrade_rt::PersistedWorkflow">persisted</a> / restored. Interaction with a workflow
(e.g., submitting messages to channel receivers or taking messages from senders)
can be performed using <a href="handle/struct.WorkflowHandle.html" title="struct tardigrade_rt::handle::WorkflowHandle"><code>WorkflowHandle</code></a>s.</p>
<h2 id="components"><a href="#components">Components</a></h2>
<p>The crate defines two major abstractions necessary to run workflows:</p>
<ul>
<li><a href="engine/index.html" title="mod tardigrade_rt::engine"><strong>Engine</strong></a> that provides a way to define, instantiate, run and snapshot workflows</li>
<li><a href="storage/index.html" title="mod tardigrade_rt::storage"><strong>Storage</strong></a> that provides a mechanism to durably persist the state of
workflows and channels connecting them and the external world</li>
</ul>
<p>For each of abstractions, there is a default implementation available: the <a href="https://docs.rs/wasmtime/"><code>wasmtime</code></a>-powered
<a href="engine/struct.Wasmtime.html" title="struct tardigrade_rt::engine::Wasmtime">engine</a> and the in-memory, in-process <a href="storage/struct.LocalStorage.html" title="struct tardigrade_rt::storage::LocalStorage">storage</a>
(it still provides a way to <a href="https://docs.rs/serde/">(de)serialize</a> a storage snapshot, so it’s not <em>completely</em> useless).</p>
<p>See the linked module docs for more details on abstractions.</p>
<h2 id="crate-features"><a href="#crate-features">Crate features</a></h2><h3 id="test"><a href="#test"><code>test</code></a></h3>
<p><em>(Off by default)</em></p>
<p>Provides the <a href="test/index.html" title="mod tardigrade_rt::test"><code>test</code></a> module with helpers for integration testing of workflows.</p>
<h3 id="async-io"><a href="#async-io"><code>async-io</code></a></h3>
<p><em>(Off by default)</em></p>
<p>Implements <a href="runtime/trait.Schedule.html" title="trait tardigrade_rt::runtime::Schedule"><code>Schedule</code></a> trait, necessary to instantiate async workflow handles,
using the <a href="https://docs.rs/async-io/"><code>async-io</code></a> crate.</p>
<h2 id="examples"><a href="#examples">Examples</a></h2><h3 id="instantiating-workflow"><a href="#instantiating-workflow">Instantiating workflow</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>tardigrade_rt::{
    engine::{Wasmtime, WorkflowEngine}, runtime::Runtime, storage::LocalStorage,
};
<span class="kw">use </span>tardigrade::spawn::CreateWorkflow;

<span class="kw">let </span>module_bytes: Vec&lt;u8&gt; = <span class="comment">// e.g., take from a file
</span><span class="kw">let </span>engine = Wasmtime::default();
<span class="kw">let </span>module = engine.create_module(module_bytes.into()).<span class="kw">await</span><span class="question-mark">?</span>;
<span class="comment">// It is possible to inspect module definitions:
</span><span class="kw">for </span>(workflow_name, interface) <span class="kw">in </span>module.interfaces() {
    <span class="macro">println!</span>(<span class="string">&quot;{workflow_name}: {interface:?}&quot;</span>);
}

<span class="comment">// Let&#39;s instantiate a runtime and add the module to it.
</span><span class="kw">let </span>storage = LocalStorage::default();
<span class="kw">let </span>runtime = Runtime::builder(engine, storage).build();
runtime.insert_module(<span class="string">&quot;test&quot;</span>, module).<span class="kw">await</span>;

<span class="comment">// Workflows are created within a runtime that is responsible
// for their persistence and managing channels, time, and child workflows.
</span><span class="kw">let </span>spawner = runtime.spawner();
<span class="kw">let </span>builder = spawner.new_workflow::&lt;()&gt;(<span class="string">&quot;test::Workflow&quot;</span>).<span class="kw">await</span><span class="question-mark">?</span>;
<span class="kw">let </span>(handles, self_handles) = builder.handles(|<span class="kw">_</span>| {}).<span class="kw">await</span>;
<span class="kw">let </span>new_workflow =
    builder.build(<span class="string">b&quot;data&quot;</span>.to_vec(), handles).<span class="kw">await</span><span class="question-mark">?</span>;

<span class="comment">// Let&#39;s initialize the workflow.
</span><span class="kw">let </span>receipt = runtime.tick().<span class="kw">await</span><span class="question-mark">?</span>.into_inner()<span class="question-mark">?</span>;
<span class="comment">// `receipt` contains information about WASM code execution. E.g.,
// this will print the executed functions and a list of important
// events for each of executions:
</span><span class="macro">println!</span>(<span class="string">&quot;{:?}&quot;</span>, receipt.executions());
<span class="comment">// It&#39;s possible to communicate with the workflow using `self_handles`
// and/or `new_workflow`.</span></code></pre></div>
<p>See <a href="runtime/struct.Runtime.html" title="struct tardigrade_rt::runtime::Runtime"><code>Runtime</code></a> docs for examples of what to do with workflows after instantiation.</p>
<h3 id="persisting-and-restoring-workflow"><a href="#persisting-and-restoring-workflow">Persisting and restoring workflow</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>runtime: Runtime&lt;Wasmtime, (), LocalStorage&gt; = <span class="comment">// ...
</span><span class="kw">let </span>workflow = runtime.storage().workflow(workflow_id).<span class="kw">await</span>.unwrap();
<span class="kw">let </span>persisted: <span class="kw-2">&amp;</span>PersistedWorkflow = workflow.persisted();
<span class="comment">// The persisted workflow can be serialized:
</span><span class="kw">let </span>json = serde_json::to_string(persisted)<span class="question-mark">?</span>;

<span class="comment">// In case of using `LocalStorage`, the entire state can be serialized
// as well:
</span><span class="kw">let </span><span class="kw-2">mut </span>storage = runtime.into_storage();
<span class="kw">let </span>json = serde_json::to_string(<span class="kw-2">&amp;</span>storage.snapshot())<span class="question-mark">?</span>;</code></pre></div>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.Clock"><code>pub use crate::runtime::<a class="trait" href="runtime/trait.Clock.html" title="trait tardigrade_rt::runtime::Clock">Clock</a>;</code></div></li><li><div class="item-name" id="reexport.Schedule"><code>pub use crate::runtime::<a class="trait" href="runtime/trait.Schedule.html" title="trait tardigrade_rt::runtime::Schedule">Schedule</a>;</code></div></li><li><div class="item-name" id="reexport.TimerFuture"><code>pub use crate::runtime::<a class="type" href="runtime/type.TimerFuture.html" title="type tardigrade_rt::runtime::TimerFuture">TimerFuture</a>;</code></div></li></ul><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="engine/index.html" title="mod tardigrade_rt::engine">engine</a></div><div class="desc docblock-short">Workflow engine abstraction.</div></li><li><div class="item-name"><a class="mod" href="handle/index.html" title="mod tardigrade_rt::handle">handle</a></div><div class="desc docblock-short">Handles for workflows in a <a href="runtime/struct.Runtime.html" title="struct tardigrade_rt::runtime::Runtime"><code>Runtime</code></a> and their components (e.g., channels).</div></li><li><div class="item-name"><a class="mod" href="receipt/index.html" title="mod tardigrade_rt::receipt">receipt</a></div><div class="desc docblock-short"><a href="receipt/struct.Receipt.html" title="struct tardigrade_rt::receipt::Receipt"><code>Receipt</code></a>s for workflows and associated types.</div></li><li><div class="item-name"><a class="mod" href="runtime/index.html" title="mod tardigrade_rt::runtime">runtime</a></div><div class="desc docblock-short"><a href="runtime/struct.Runtime.html" title="struct tardigrade_rt::runtime::Runtime"><code>Runtime</code></a> and tightly related types.</div></li><li><div class="item-name"><a class="mod" href="storage/index.html" title="mod tardigrade_rt::storage">storage</a></div><div class="desc docblock-short">Async, transactional storage abstraction for storing workflows and channel state.</div></li><li><div class="item-name"><a class="mod" href="test/index.html" title="mod tardigrade_rt::test">test</a><span class="stab portability" title="Available on crate feature `test` only"><code>test</code></span></div><div class="desc docblock-short">Helpers for workflow integration testing.</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.AsyncIoScheduler.html" title="struct tardigrade_rt::AsyncIoScheduler">AsyncIoScheduler</a><span class="stab portability" title="Available on crate feature `async-io` only"><code>async-io</code></span></div><div class="desc docblock-short"><a href="runtime/trait.Schedule.html" title="trait tardigrade_rt::runtime::Schedule">Scheduler</a> implementation from <a href="https://docs.rs/async-io/"><code>async-io</code></a> (a part of <a href="https://docs.rs/async-std/"><code>async-std</code></a> suite).</div></li><li><div class="item-name"><a class="struct" href="struct.Channels.html" title="struct tardigrade_rt::Channels">Channels</a></div><div class="desc docblock-short">Information about channels for a particular workflow interface.</div></li><li><div class="item-name"><a class="struct" href="struct.ChildWorkflow.html" title="struct tardigrade_rt::ChildWorkflow">ChildWorkflow</a></div><div class="desc docblock-short">State of child workflow as viewed by its parent.</div></li><li><div class="item-name"><a class="struct" href="struct.MockScheduler.html" title="struct tardigrade_rt::MockScheduler">MockScheduler</a></div><div class="desc docblock-short">Mock <a href="runtime/trait.Clock.html" title="trait tardigrade_rt::runtime::Clock">wall clock</a> and <a href="runtime/trait.Schedule.html" title="trait tardigrade_rt::runtime::Schedule">scheduler</a>.</div></li><li><div class="item-name"><a class="struct" href="struct.PersistedWorkflow.html" title="struct tardigrade_rt::PersistedWorkflow">PersistedWorkflow</a></div><div class="desc docblock-short">Persisted version of a workflow containing the state of its external dependencies
(channels and timers), and its linear WASM memory.</div></li><li><div class="item-name"><a class="struct" href="struct.ReceiverState.html" title="struct tardigrade_rt::ReceiverState">ReceiverState</a></div><div class="desc docblock-short">State of a workflow channel receiver.</div></li><li><div class="item-name"><a class="struct" href="struct.SenderState.html" title="struct tardigrade_rt::SenderState">SenderState</a></div><div class="desc docblock-short">State of a workflow channel sender.</div></li><li><div class="item-name"><a class="struct" href="struct.TaskState.html" title="struct tardigrade_rt::TaskState">TaskState</a></div><div class="desc docblock-short">State of a task within a workflow.</div></li><li><div class="item-name"><a class="struct" href="struct.TimerState.html" title="struct tardigrade_rt::TimerState">TimerState</a></div><div class="desc docblock-short">State of a workflow timer.</div></li><li><div class="item-name"><a class="struct" href="struct.TokioScheduler.html" title="struct tardigrade_rt::TokioScheduler">TokioScheduler</a><span class="stab portability" title="Available on crate feature `tokio` only"><code>tokio</code></span></div><div class="desc docblock-short"><a href="runtime/trait.Schedule.html" title="trait tardigrade_rt::runtime::Schedule">Scheduler</a> implementation from <a href="https://docs.rs/tokio/"><code>tokio</code></a>.</div></li></ul></section></div></main></body></html>