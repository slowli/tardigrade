<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Async, transactional storage abstraction for storing workflows and channel state."><title>tardigrade_rt::storage - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-47e7ab555ef2818a.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="tardigrade_rt" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0-nightly (62ebe3a2b 2023-09-08)" data-channel="nightly" data-search-js="search-5d3eaacf19ebf04f.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-f194925aa375ae96.css" data-theme-dark-css="dark-1dd4d1ce031e15de.css" data-theme-ayu-css="ayu-49e58d069f567085.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-ef3a2de404864b0b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-f194925aa375ae96.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-1dd4d1ce031e15de.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../tardigrade_rt/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../tardigrade_rt/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module storage</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">tardigrade_rt</a>::<wbr><a class="mod" href="#">storage</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/tardigrade_rt/storage/mod.rs.html#1-358">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Async, transactional storage abstraction for storing workflows and channel state.</p>
<h2 id="overview"><a href="#overview">Overview</a></h2>
<p>The core trait of this module is <a href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage"><code>Storage</code></a>, which produces storage transactions:</p>
<ul>
<li><a href="trait.ReadonlyStorageTransaction.html" title="trait tardigrade_rt::storage::ReadonlyStorageTransaction"><code>ReadonlyStorageTransaction</code></a> for reading data</li>
<li><a href="trait.StorageTransaction.html" title="trait tardigrade_rt::storage::StorageTransaction"><code>StorageTransaction</code></a> for reading and writing data</li>
</ul>
<p>Transactions must have at least snapshot isolation.</p>
<p>The data operated by transactions is as follows:</p>
<div><table><thead><tr><th>Entity type</th><th>Read trait</th><th>Write trait</th></tr></thead><tbody>
<tr><td><a href="struct.ModuleRecord.html" title="struct tardigrade_rt::storage::ModuleRecord"><code>ModuleRecord</code></a></td><td><a href="trait.ReadModules.html" title="trait tardigrade_rt::storage::ReadModules"><code>ReadModules</code></a></td><td><a href="trait.WriteModules.html" title="trait tardigrade_rt::storage::WriteModules"><code>WriteModules</code></a></td></tr>
<tr><td><a href="struct.ChannelRecord.html" title="struct tardigrade_rt::storage::ChannelRecord"><code>ChannelRecord</code></a></td><td><a href="trait.ReadChannels.html" title="trait tardigrade_rt::storage::ReadChannels"><code>ReadChannels</code></a></td><td><a href="trait.WriteChannels.html" title="trait tardigrade_rt::storage::WriteChannels"><code>WriteChannels</code></a></td></tr>
<tr><td><a href="struct.WorkflowRecord.html" title="struct tardigrade_rt::storage::WorkflowRecord"><code>WorkflowRecord</code></a></td><td><a href="trait.ReadWorkflows.html" title="trait tardigrade_rt::storage::ReadWorkflows"><code>ReadWorkflows</code></a></td><td><a href="trait.WriteWorkflows.html" title="trait tardigrade_rt::storage::WriteWorkflows"><code>WriteWorkflows</code></a></td></tr>
<tr><td><a href="struct.WorkflowWakerRecord.html" title="struct tardigrade_rt::storage::WorkflowWakerRecord"><code>WorkflowWakerRecord</code></a></td><td>n/a</td><td><a href="trait.WriteWorkflowWakers.html" title="trait tardigrade_rt::storage::WriteWorkflowWakers"><code>WriteWorkflowWakers</code></a></td></tr>
</tbody></table>
</div>
<p>The <code>ReadonlyStorageTransaction</code> trait encompasses all read traits, and <code>StorageTransaction</code>
encompasses both read and write traits. To simplify readonly transaction implementation without
sacrificing type safety, there is <a href="struct.Readonly.html" title="struct tardigrade_rt::storage::Readonly"><code>Readonly</code></a> wrapper.</p>
<p>In terms of domain-driven development, modules, channels and workflows are independent
aggregate roots, while workflow wakers are tied to a workflow.
<code>_Record</code> types do not precisely correspond to the relational data model, but can be
straightforwardly mapped onto one. In particular, <a href="struct.WorkflowRecord.html" title="struct tardigrade_rt::storage::WorkflowRecord"><code>WorkflowRecord</code></a> has the workflow state
as a type param. The state is modelled via enum dispatch on the <a href="enum.WorkflowState.html" title="enum tardigrade_rt::storage::WorkflowState"><code>WorkflowState</code></a> enum and
its variants (e.g., <a href="struct.ActiveWorkflowState.html" title="struct tardigrade_rt::storage::ActiveWorkflowState"><code>ActiveWorkflowState</code></a> for active workflows).</p>
<p>Besides the <a href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage"><code>Storage</code></a> trait, the module provides its local in-memory implementation:
<a href="struct.LocalStorage.html" title="struct tardigrade_rt::storage::LocalStorage"><code>LocalStorage</code></a>. It has <a href="struct.LocalTransaction.html" title="struct tardigrade_rt::storage::LocalTransaction"><code>LocalTransaction</code></a> transactions and provides
<a href="struct.LocalStorageSnapshot.html" title="struct tardigrade_rt::storage::LocalStorageSnapshot"><code>LocalStorageSnapshot</code></a> as a way to get (de)serializable snapshot of the storage.</p>
<h2 id="see-also"><a href="#see-also">See also</a></h2>
<ul>
<li><a href="../handle/struct.StorageRef.html" title="struct tardigrade_rt::handle::StorageRef"><code>StorageRef</code></a>, a wrapper around a <code>Storage</code> that allows
accessing <a href="../handle/struct.WorkflowHandle.html" title="struct tardigrade_rt::handle::WorkflowHandle">workflow</a> and channel <a href="../handle/struct.MessageSender.html" title="struct tardigrade_rt::handle::MessageSender">sender</a> / <a href="../handle/struct.MessageReceiver.html" title="struct tardigrade_rt::handle::MessageReceiver">receiver</a>
handles</li>
</ul>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ActiveWorkflowState.html" title="struct tardigrade_rt::storage::ActiveWorkflowState">ActiveWorkflowState</a></div><div class="desc docblock-short">State of an active workflow.</div></li><li><div class="item-name"><a class="struct" href="struct.ChannelRecord.html" title="struct tardigrade_rt::storage::ChannelRecord">ChannelRecord</a></div><div class="desc docblock-short">State of a workflow channel.</div></li><li><div class="item-name"><a class="struct" href="struct.CommitStream.html" title="struct tardigrade_rt::storage::CommitStream">CommitStream</a></div><div class="desc docblock-short">Stream of commits returned from <a href="struct.Streaming.html#method.stream_commits" title="method tardigrade_rt::storage::Streaming::stream_commits"><code>Streaming::stream_commits()</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.CompletedWorkflowState.html" title="struct tardigrade_rt::storage::CompletedWorkflowState">CompletedWorkflowState</a></div><div class="desc docblock-short">State of a completed workflow.</div></li><li><div class="item-name"><a class="struct" href="struct.DefinitionRecord.html" title="struct tardigrade_rt::storage::DefinitionRecord">DefinitionRecord</a></div><div class="desc docblock-short">Storage record for a workflow definition.</div></li><li><div class="item-name"><a class="struct" href="struct.ErroneousMessageRef.html" title="struct tardigrade_rt::storage::ErroneousMessageRef">ErroneousMessageRef</a></div><div class="desc docblock-short">Reference for a potentially erroneous message in <a href="struct.ErroredWorkflowState.html" title="struct tardigrade_rt::storage::ErroredWorkflowState"><code>ErroredWorkflowState</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.ErroredWorkflowState.html" title="struct tardigrade_rt::storage::ErroredWorkflowState">ErroredWorkflowState</a></div><div class="desc docblock-short">State of an errored workflow.</div></li><li><div class="item-name"><a class="struct" href="struct.InProcessConnection.html" title="struct tardigrade_rt::storage::InProcessConnection">InProcessConnection</a></div><div class="desc docblock-short">Wrapper around a <a href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage"><code>Storage</code></a> implementing [<code>WorkerConnection</code>] trait.
This can be used for in-process workers.</div></li><li><div class="item-name"><a class="struct" href="struct.LocalReadonlyTransaction.html" title="struct tardigrade_rt::storage::LocalReadonlyTransaction">LocalReadonlyTransaction</a></div><div class="desc docblock-short">Readonly transaction used by <a href="struct.LocalStorage.html" title="struct tardigrade_rt::storage::LocalStorage"><code>LocalStorage</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.LocalStorage.html" title="struct tardigrade_rt::storage::LocalStorage">LocalStorage</a></div><div class="desc docblock-short">Local in-memory <a href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage"><code>Storage</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.LocalStorageSnapshot.html" title="struct tardigrade_rt::storage::LocalStorageSnapshot">LocalStorageSnapshot</a></div><div class="desc docblock-short">Serializable snapshot of a <a href="struct.LocalStorage.html" title="struct tardigrade_rt::storage::LocalStorage"><code>LocalStorage</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.LocalTransaction.html" title="struct tardigrade_rt::storage::LocalTransaction">LocalTransaction</a></div><div class="desc docblock-short">Transaction used by <a href="struct.LocalStorage.html" title="struct tardigrade_rt::storage::LocalStorage"><code>LocalStorage</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.MessageEvent.html" title="struct tardigrade_rt::storage::MessageEvent">MessageEvent</a></div><div class="desc docblock-short">Event signalling that one or more messages were added to the channel.</div></li><li><div class="item-name"><a class="struct" href="struct.ModuleRecord.html" title="struct tardigrade_rt::storage::ModuleRecord">ModuleRecord</a></div><div class="desc docblock-short">Storage record for a <a href="../engine/trait.WorkflowModule.html" title="trait tardigrade_rt::engine::WorkflowModule"><code>WorkflowModule</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.ModuleRecordMut.html" title="struct tardigrade_rt::storage::ModuleRecordMut">ModuleRecordMut</a></div><div class="desc docblock-short">Thin wrapper around <a href="struct.ModuleRecord.html" title="struct tardigrade_rt::storage::ModuleRecord"><code>ModuleRecord</code></a> that allows accessing its fields and changing
only module bytes.</div></li><li><div class="item-name"><a class="struct" href="struct.Readonly.html" title="struct tardigrade_rt::storage::Readonly">Readonly</a></div><div class="desc docblock-short">Wrapper for <a href="trait.StorageTransaction.html" title="trait tardigrade_rt::storage::StorageTransaction"><code>StorageTransaction</code></a> implementations that allows safely using them
as readonly transactions.</div></li><li><div class="item-name"><a class="struct" href="struct.Streaming.html" title="struct tardigrade_rt::storage::Streaming">Streaming</a></div><div class="desc docblock-short">Storage that streams <a href="struct.MessageEvent.html" title="struct tardigrade_rt::storage::MessageEvent">events</a> about new messages when they are committed.</div></li><li><div class="item-name"><a class="struct" href="struct.StreamingTransaction.html" title="struct tardigrade_rt::storage::StreamingTransaction">StreamingTransaction</a></div><div class="desc docblock-short">Wrapper around a transaction that streams <a href="struct.MessageEvent.html" title="struct tardigrade_rt::storage::MessageEvent"><code>MessageEvent</code></a>s on commit. Used
as the transaction type for <a href="struct.Streaming.html" title="struct tardigrade_rt::storage::Streaming"><code>Streaming</code></a> storages.</div></li><li><div class="item-name"><a class="struct" href="struct.TransactionAsStorage.html" title="struct tardigrade_rt::storage::TransactionAsStorage">TransactionAsStorage</a></div><div class="desc docblock-short"><a href="trait.StorageTransaction.html" title="trait tardigrade_rt::storage::StorageTransaction">Transaction</a> acting as a <a href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage"><code>Storage</code></a>. This allows atomically
committing multiple operations which would normally require multiple transactions
(e.g., pushing messages to multiple channels using channel <a href="../handle/index.html" title="mod tardigrade_rt::handle">handles</a>),
or committing operations with a delay (e.g., committing a workflow after it was successfully
initialized).</div></li><li><div class="item-name"><a class="struct" href="struct.TransactionLock.html" title="struct tardigrade_rt::storage::TransactionLock">TransactionLock</a></div><div class="desc docblock-short">Transaction on top of <a href="struct.TransactionAsStorage.html" title="struct tardigrade_rt::storage::TransactionAsStorage"><code>TransactionAsStorage</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.TransactionReadLock.html" title="struct tardigrade_rt::storage::TransactionReadLock">TransactionReadLock</a></div><div class="desc docblock-short">Readonly transaction on top of <a href="struct.TransactionAsStorage.html" title="struct tardigrade_rt::storage::TransactionAsStorage"><code>TransactionAsStorage</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.WorkflowRecord.html" title="struct tardigrade_rt::storage::WorkflowRecord">WorkflowRecord</a></div><div class="desc docblock-short">State of a workflow.</div></li><li><div class="item-name"><a class="struct" href="struct.WorkflowWakerRecord.html" title="struct tardigrade_rt::storage::WorkflowWakerRecord">WorkflowWakerRecord</a></div><div class="desc docblock-short">Record associating a <a href="enum.WorkflowWaker.html" title="enum tardigrade_rt::storage::WorkflowWaker"><code>WorkflowWaker</code></a> with a particular workflow.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.MessageError.html" title="enum tardigrade_rt::storage::MessageError">MessageError</a></div><div class="desc docblock-short">Error retrieving a message from a workflow channel. Returned by
<a href="trait.ReadChannels.html#tymethod.channel_message" title="method tardigrade_rt::storage::ReadChannels::channel_message"><code>ReadChannels::channel_message()</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.MessageOrEof.html" title="enum tardigrade_rt::storage::MessageOrEof">MessageOrEof</a></div><div class="desc docblock-short">Message from a channel or the channel end marker.</div></li><li><div class="item-name"><a class="enum" href="enum.WorkflowSelectionCriteria.html" title="enum tardigrade_rt::storage::WorkflowSelectionCriteria">WorkflowSelectionCriteria</a></div><div class="desc docblock-short">Workflow selection criteria used in <a href="trait.WriteWorkflowWakers.html#tymethod.insert_waker_for_matching_workflows" title="method tardigrade_rt::storage::WriteWorkflowWakers::insert_waker_for_matching_workflows"><code>insert_waker_for_matching_workflows()</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.WorkflowState.html" title="enum tardigrade_rt::storage::WorkflowState">WorkflowState</a></div><div class="desc docblock-short">State of a <a href="struct.WorkflowRecord.html" title="struct tardigrade_rt::storage::WorkflowRecord"><code>WorkflowRecord</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.WorkflowWaker.html" title="enum tardigrade_rt::storage::WorkflowWaker">WorkflowWaker</a></div><div class="desc docblock-short">Waker for a workflow.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ReadChannels.html" title="trait tardigrade_rt::storage::ReadChannels">ReadChannels</a></div><div class="desc docblock-short">Allows reading stored information about workflow channels.</div></li><li><div class="item-name"><a class="trait" href="trait.ReadModules.html" title="trait tardigrade_rt::storage::ReadModules">ReadModules</a></div><div class="desc docblock-short">Allows reading stored information about <a href="../engine/trait.WorkflowModule.html" title="trait tardigrade_rt::engine::WorkflowModule"><code>WorkflowModule</code></a>s.</div></li><li><div class="item-name"><a class="trait" href="trait.ReadWorkflows.html" title="trait tardigrade_rt::storage::ReadWorkflows">ReadWorkflows</a></div><div class="desc docblock-short">Allows reading information about workflows.</div></li><li><div class="item-name"><a class="trait" href="trait.ReadonlyStorageTransaction.html" title="trait tardigrade_rt::storage::ReadonlyStorageTransaction">ReadonlyStorageTransaction</a></div><div class="desc docblock-short"><a href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage"><code>Storage</code></a> transaction with readonly access to the storage.</div></li><li><div class="item-name"><a class="trait" href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage">Storage</a></div><div class="desc docblock-short">Async, transactional storage for workflows and workflow channels.</div></li><li><div class="item-name"><a class="trait" href="trait.StorageTransaction.html" title="trait tardigrade_rt::storage::StorageTransaction">StorageTransaction</a></div><div class="desc docblock-short"><a href="trait.Storage.html" title="trait tardigrade_rt::storage::Storage"><code>Storage</code></a> transaction with read/write access to the storage.</div></li><li><div class="item-name"><a class="trait" href="trait.StreamMessages.html" title="trait tardigrade_rt::storage::StreamMessages">StreamMessages</a></div><div class="desc docblock-short">Allows streaming messages from a certain channel as they are written to it.</div></li><li><div class="item-name"><a class="trait" href="trait.WriteChannels.html" title="trait tardigrade_rt::storage::WriteChannels">WriteChannels</a></div><div class="desc docblock-short">Allows modifying stored information about channels.</div></li><li><div class="item-name"><a class="trait" href="trait.WriteModules.html" title="trait tardigrade_rt::storage::WriteModules">WriteModules</a></div><div class="desc docblock-short">Allows modifying stored information about <a href="../engine/trait.WorkflowModule.html" title="trait tardigrade_rt::engine::WorkflowModule"><code>WorkflowModule</code></a>s.</div></li><li><div class="item-name"><a class="trait" href="trait.WriteWorkflowWakers.html" title="trait tardigrade_rt::storage::WriteWorkflowWakers">WriteWorkflowWakers</a></div><div class="desc docblock-short">Allows modifying stored information about <a href="enum.WorkflowWaker.html" title="enum tardigrade_rt::storage::WorkflowWaker"><code>WorkflowWaker</code></a>.</div></li><li><div class="item-name"><a class="trait" href="trait.WriteWorkflows.html" title="trait tardigrade_rt::storage::WriteWorkflows">WriteWorkflows</a></div><div class="desc docblock-short">Allows modifying stored information about workflows.</div></li></ul></section></div></main></body></html>